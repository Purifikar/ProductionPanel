<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kanban ProduÃ§Ã£o IPF</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  
  <header>
    <div class="logo">
      <img src="https://via.placeholder.com/40x40?text=Logo" alt="Purifikar Logo" />
      <strong>PURIFIKARÂ®</strong>
    </div>
    <nav>
      <a href="standard_page.html">VisÃ£o Geral de Aparelhos</a>
      <button class="refresh-button" onclick="location.reload()">Atualizar</button>
      <button onclick="testeEnvio()">Enviar Dados</button>
      <button id="refresh-btn">ðŸ”„ Atualizar Painel</button>
    </nav>
  </header>


  <h1>PRODUÃ‡ÃƒO IPF</h1>


  <div class="kanban-board" id="kanbanBoard">
    <div class="kanban-column" id="novos" data-status="novos">
      <h2>Novas OS</h2>
    </div>
    <div class="kanban-column" id="aproduzir" data-status="aproduzir">
      <h2>A produzir</h2>
    </div>
    <div class="kanban-column" id="emproducao" data-status="emproducao">
      <h2>Em produÃ§Ã£o</h2>
    </div>
    <div class="kanban-column" id="finalizado" data-status="finalizado">
      <h2>Finalizado</h2>
    </div>
  </div>

  <div id="pedidoModal" class="modal hidden">
    <div class="modal-content">
      <span class="close-button" onclick="fecharModal()">&times;</span>
      <div id="modalInfo"></div>
      <div id="materialList" class="material-list"></div>
    </div>
  </div>

  <!-- =====  SCRIPT  ===== -->
  <script src="n8n.js"></script>
  <script>



    // Dados mockados para pedidos e materiais
    const pedidos = [
      { id: 1, nome: "WIND CLEAN STANDARD TIME INOX DIREITO", codigo: "WC-ST04-T-I-D", quantidade: 12, produzidos: 12, status: "finalizado" },
      { id: 2, nome: "WIND CLEAN STANDARD TIME INOX ESQUERDO", codigo: "WC-ST04-T-I-E", quantidade: 3, produzidos: 3, status: "finalizado" },
      { id: 3, nome: "STANDARD SENSOR DIREITO", codigo: "WC-ST04-S-D", quantidade: 5, produzidos: 2, status: "emproducao" },
      { id: 4, nome: "STANDARD SENSOR ESQUERDO", codigo: "WC-ST04-S-E", quantidade: 10, produzidos: 0, status: "aproduzir" },
      { id: 5, nome: "STANDARD SENSOR ESQUERDO", codigo: "WC-ST04-S-E", quantidade: 10, produzidos: 0, status: "aproduzir" }
    ];

    const materiaisPorProduto = {
      "WC-ST04-T-I-E": [
        { descricao: "TAMPA INTERNA DE PROTEÃ‡ÃƒO COOLER", quantidade: "3 UNI" },
        { descricao: "SUPORTE DO COOLER", quantidade: "3 UNI" },
        { descricao: "GRADE TELA 120X120", quantidade: "3 UNI" },
        { descricao: "PARAFUSO AB INOX 5X8", quantidade: "15 UNI" },
        { descricao: "MINIVENTILADOR RT-120", quantidade: "3 UNI" }
      ],
      "WC-ST04-T-I-D": [
        { descricao: "TAMPA INTERNA DE PROTEÃ‡ÃƒO COOLER", quantidade: "12 UNI" },
        { descricao: "SUPORTE DO COOLER", quantidade: "12 UNI" },
        { descricao: "GRADE TELA 120X120", quantidade: "12 UNI" },
        { descricao: "PARAFUSO AB INOX 5X8", quantidade: "60 UNI" },
        { descricao: "MINIVENTILADOR RT-120", quantidade: "12 UNI" }
      ]
    };

    function renderPedidos() {
      pedidos.forEach(pedido => {
        const card = document.createElement("div");
        card.className = "pedido-card";

        card.setAttribute("draggable", true);
        card.id = `card-${pedido.id}`;
        card.dataset.id = pedido.id;

        card.innerHTML = `
          <strong>${pedido.nome}</strong>
          <small>${pedido.codigo}</small>
          <span>ðŸ“¦ ${pedido.quantidade} UNI (${pedido.produzidos} produzidos)</span>
        `;

    
        card.addEventListener("click", (e) => {
    
          if (e.detail === 1 && !card.classList.contains("dragging")) {
            abrirModal(pedido);
          }
        });

    
        card.addEventListener("dragstart", handleDragStart);
        card.addEventListener("dragend", handleDragEnd);

        const coluna = document.getElementById(pedido.status);
        coluna.appendChild(card);
      });
    }

    
    function abrirModal(pedido) {
      const modal = document.getElementById("pedidoModal");
      const modalInfo = document.getElementById("modalInfo");
      const materialList = document.getElementById("materialList");

      modalInfo.innerHTML = `
        <h2>Detalhes do Pedido</h2>
        <p><strong>${pedido.nome}</strong></p>
        <p>CÃ³digo: ${pedido.codigo}</p>
        <p>Quantidade Total: ${pedido.quantidade}</p>
        <p>Produzidos: ${pedido.produzidos}</p>
      `;

      const materiais = materiaisPorProduto[pedido.codigo] || [];
      if (materiais.length) {
        let tabela = '<h3>Materiais NecessÃ¡rios</h3><table><thead><tr><th>DescriÃ§Ã£o</th><th>Qtd</th></tr></thead><tbody>';
        materiais.forEach(item => {
          tabela += `<tr><td>${item.descricao}</td><td>${item.quantidade}</td></tr>`;
        });
        tabela += '</tbody></table>';
        materialList.innerHTML = tabela;
      } else {
        materialList.innerHTML = '<p><em>Sem dados de materiais.</em></p>';
      }

      modal.classList.remove("hidden");
    }

    function fecharModal() {
      document.getElementById("pedidoModal").classList.add("hidden");
    }

    
    function handleDragStart(e) {
    
      this.classList.add("dragging");
      e.dataTransfer.effectAllowed = "move";
      e.dataTransfer.setData("text/plain", this.id);
      
      setTimeout(() => this.style.opacity = "0.4", 0);
    }

    function handleDragEnd() {
      this.classList.remove("dragging");
      this.style.opacity = "1";
    }

    function handleDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = "move";
    }

    function handleDrop(e) {
      e.preventDefault();
      const cardId = e.dataTransfer.getData("text/plain");
      const card = document.getElementById(cardId);
      if (!card) return;

      this.appendChild(card);

      
      const pedido = pedidos.find(p => `card-${p.id}` === cardId);
      if (pedido) pedido.status = this.dataset.status;
    }

    function addDnDListeners() {
      const columns = document.querySelectorAll(".kanban-column");
      columns.forEach(col => {
        col.addEventListener("dragover", handleDragOver);
        col.addEventListener("drop", handleDrop);
      });
    }

    
    document.addEventListener("DOMContentLoaded", () => {
      renderPedidos();
      addDnDListeners();
    });
  </script>
  
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
  <script type="module" src="panel-api.js"></script>

</body>
</html>
